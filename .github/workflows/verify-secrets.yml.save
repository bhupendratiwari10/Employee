name: Verify Secrets

on:
  workflow_dispatch:

jobs:
  verify:
    runs-on: ubuntu-latest
    
    steps:
    - name: üîç Check if secrets exist
      run: |
        echo "Checking if secrets are configured..."
        
        # Check each secret (without revealing values)
        if [ -n "${{ secrets.HOSTINGER_HOST }}" ]; then
          echo "‚úÖ HOSTINGER_HOST is set"
        else
          echo "‚ùå HOSTINGER_HOST is NOT set"
        fi
        
        if [ -n "${{ secrets.HOSTINGER_PORT }}" ]; then
          echo "‚úÖ HOSTINGER_PORT is set"
        else
          echo "‚ùå HOSTINGER_PORT is NOT set"
        fi
        
        if [ -n "${{ secrets.HOSTINGER_USERNAME }}" ]; then
          echo "‚úÖ HOSTINGER_USERNAME is set"
        else
          echo "‚ùå HOSTINGER_USERNAME is NOT set"
        fi
        
        if [ -n "${{ secrets.HOSTINGER_SSH_KEY }}" ]; then
          echo "‚úÖ HOSTINGER_SSH_KEY is set"
          # Check if it looks like an SSH key (without revealing it)
          if [[ "${{ secrets.HOSTINGER_SSH_KEY }}" == *"BEGIN"* ]]; then
            echo "‚úÖ SSH key format looks correct"
          else
            echo "‚ö†Ô∏è  SSH key might not be in correct format"
          fi
        else
          echo "‚ùå HOSTINGER_SSH_KEY is NOT set"
        fi
        
        if [ -n "${{ secrets.DEPLOY_PATH }}" ]; then
          echo "‚úÖ DEPLOY_PATH is set"
          # Show just the length to verify it exists
          echo "   Path length: ${#DEPLOY_PATH} characters"
        else
          echo "‚ùå DEPLOY_PATH is NOT set"
        fi
        
    - name: üîå Test SSH connection
      uses: appleboy/ssh-action@v0.1.5
      with:
        host: ${{ secrets.HOSTINGER_HOST }}
        username: ${{ secrets.HOSTINGER_USERNAME }}
        key: ${{ secrets.HOSTINGER_SSH_KEY }}
        port: ${{ secrets.HOSTINGER_PORT }}
        script: |
          echo "‚úÖ SSH Connection successful!"
          echo "Connected as: $(whoami)"
          echo "Server: $(hostname)"
          
          # Verify deploy path exists
          if [ -d "${{ secrets.DEPLOY_PATH }}" ]; then
            echo "‚úÖ Deploy path exists: ${{ secrets.DEPLOY_PATH }}"
          else
            echo "‚ùå Deploy path does not exist: ${{ secrets.DEPLOY_PATH }}"
            echo "Creating directory..."
            mkdir -p "${{ secrets.DEPLOY_PATH }}"
          fi
